<%= stylesheet_link_tag 'spots', 'data-turbolinks-track': 'reload' %>

<div class="container">
  <div class="card-total">
    <%= link_to spot_path(@spot) do %>
    <% end %>

  <div class="card-body">
    <h2><%= @spot.datestring %></h2>
    <iframe
      width="600"
      height="450"
      frameborder="0" style="border:0"
      src="https://www.google.com/maps/embed/v1/place?key=<%=ENV['google_maps_api_key']%>
      &q=<%="#{@spot.spot}"%>+<%="#{@spot.location}"%>" allowfullscreen>
    </iframe>

    <div class="spot-title-time"
      <h1><a class="spot-title"<%= link_to @spot.spot, spot_path(@spot)%></a></h1>
      <p class="spot-time"><%= @spot.time_start %> - <%= @spot.time_end %></p>
    </div>

    <p><%= @spot.location %></p>
    <p><%= @spot.info %></p>

    <div class="spot-follow-avatars"
      <%= render 'follows/spot_follower_list' %>
    </div><br>

    <div class="spot-user-options">
      <% if current_user.id == @spot.user_id %>
        <%= render 'spots/partials/spot_user_options' %>
      <% else if @spot.followed_by?(current_user) %>
        <%= render 'follows/spot_unfollow_option' %>
      <% else %>
        <%= render 'follows/spot_follow_option' %>
      <% end %>
    <% end %>
    </div>

    <div id="comments">
      <button type="button" class="btn btn-secondary" onclick="showComments()">Comments</button>
    </div>
    <div class="card-body">
      <div id="UserComments" style="display:none;">
        <% @spot.comments.each do |comment| %>
      <div>

    <div id="comment-picture">
                  <%= link_to profile_path(comment.user_id) do %>
                  <% @users.each do |user| %>
                    <% if user.id == comment.user_id %>
                      <%= link_to profile_path(user.id) do %>
                        <% if user.avatar.attached? %>
                          <%= image_tag user.avatar.variant(resize: "50x50!"), class: "tar rounded-circle" %>
                            <% if current_user.id == comment.user_id %>
                              <%= link_to 'X', [comment.spot, comment],
                                method: :delete,
                                data: { confirm: 'Are you sure?'},
                                class: "red  btn-sm" %>
                            <% end %>
                        <% else %>
                          <%= image_tag gravatar_image_url(user.email, size: 75), height: 50, width: 50, class: "tar rounded-circle" %>
                        <% end %>
                      <% end %>
                    <% end %>
                  <% end %>
                  <% end %>
                </div>
                <div id="comment-body">
                  <p><%= comment.content%></p>
                </div>
                <div style="clear:both;"></div>
                <div id="created-at">
                  <small><%= comment.created_at %></small>
                </div>
                <div style="clear:both;"></div>
                <hr>
              </div>
              <% end %>
              <h3>Add comment</h3>
            <hr>
            <%= form_for ([@spot, @spot.comments.build]) do |f| %>

              <p>
                <%= f.label :comment %><br>
                <%= f.text_field(:content, {:class => 'form-control'}) %>
              </p>
              <p>
                <%= f.submit({:class => 'btn btn-primary'}) %>
              </p>
              <% end %>
              </div>
        </div>
      </div>
    </div>
  </div>
