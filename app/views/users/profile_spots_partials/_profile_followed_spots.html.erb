<div class="container">
  <div class="profile-greeting">
    <% if @user.id == current_user.id %>
      <h1 class ="text">Hey, <%= current_user.username %>! Check out where you'll be lunching.</h1>
    <% else %>
      <h1 class ="text">Check out where <%= @user.username %> is lunching!</h1>
    <% end %>
  </div>

    <% @allspots.each do |spot| %>
      <% if spot.followed_by?(@user) %>

        <div class="card-total">
          <%= link_to spot_path(spot) do %>
          <% end %>
            <div class="card-body">
              <h2><%= spot.datestring %></h2>
              <iframe
                width="600"
                height="450"
                frameborder="0" style="border:0"
                src="https://www.google.com/maps/embed/v1/place?key=<%=ENV['google_maps_api_key']%>
                  &q=<%="#{spot.spot}"%><% "#{spot.location}"%>" allowfullscreen>
              </iframe>
              <div class="spot-title-time"
                <h1><a class="spot-title"<%= link_to spot.spot, spot_path(spot)%></a></h1>
                <p class="spot-time"><%= spot.time_start %> - <%= spot.time_end %></p>
              </div>
              <p><%= spot.location %></p>
              <p><%= spot.info %></p>

            <div class="spot-followers"
              <img><% @users.each do |user| %>
                <% if user.id == spot.user_id %>
                  <%= link_to profile_path(user.id) do %>
                    <% if user.avatar.attached? %>
                      <%= image_tag user.avatar.variant(resize: "50x50!"), class: "tar rounded-circle" %>
                    <% else %>
                      <%= image_tag gravatar_image_url(user.email, size: 75), height: 50, width: 50, class: "tar rounded-circle" %>
                    <% end %>
                  <% end %>
                <% end %>
              <% end %>
              </img>
              <img><% spot.followers.each do |follower| %>
                <%= link_to profile_path(follower.id) do %>
                  <% if follower.avatar.attached? %>
                    <%= image_tag follower.avatar.variant(resize: "50x50!"), class: "tar rounded-circle" %>
                  <% else %>
                    <%= image_tag gravatar_image_url(follower.email, size: 75), height: 50, width: 50, class: "tar rounded-circle" %>
                  <% end %>
                <% end %>
              <% end %>
              </img>
            </div>

            <% if spot.user_id != current_user.id %>
              <% if spot.followed_by?(current_user) %>
              <div class="spot-user-options">
                <div class="spot-user-option">
                  <%= form_tag unfollow_spot_path(id: spot.id), method: :post, data: {confirm: 'You monster.'}, remote: true do  %>
                  <%= button_tag 'Leave Spot', :class => 'btn btn-danger' %><% end %>
                </div>
              </div>
              <% else %>
              <div class="spot-user-options">
                <div class="spot-user-option">
                  <%= form_tag follow_spot_path(id: spot.id), method: :post, data: {confirm: 'Joined a lunch spot!'}, remote: true do  %>
                  <%= button_tag 'Join Spot', :class => 'btn btn-success' %><% end %>
                </div>
              </div>
              <% end %>
            <% end %>
            </div>
          </div>
        <% end %>
    <% end %>
</div>
